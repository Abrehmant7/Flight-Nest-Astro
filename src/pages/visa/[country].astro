---
import Layout from "../../layouts/layout.astro";
import { Image } from "astro:assets";

export function getStaticPaths() {
    return [
        { params: { country: "france" } },
        { params: { country: "greece" } },
        { params: { country: "portugal" } },
        { params: { country: "estonia" } },
        { params: { country: "netherlands" } },
        { params: { country: "canada" } },
        { params: { country: "denmark" } },
        { params: { country: "switzerland" } },
        { params: { country: "sweden" } },
        { params: { country: "usa" } },
    ];
}

const { country } = Astro.params;
const countryName = country
    ? country.charAt(0).toUpperCase() + country.slice(1)
    : "Unknown";

// Special case for USA
const displayName = country?.toLowerCase() === "usa" ? "USA" : countryName;

// Dynamically import all images from the assets folder
const images = import.meta.glob<{ default: ImageMetadata }>(
    "../../assets/images/*.{jpeg,jpg,png,gif,avif}",
);

// precise matching logic
let imagePath = `../../assets/images/${country?.toLowerCase()}.jpg`;
// try to find a key that includes the country name (case insensitive)
if (!images[imagePath]) {
    // Check for png as well since some generated images are png
    let pngPath = `../../assets/images/${country?.toLowerCase()}.png`;
    if (images[pngPath]) {
        imagePath = pngPath;
    } else {
        const foundKey = Object.keys(images).find((key) =>
            key.toLowerCase().includes(country?.toLowerCase() || ""),
        );
        if (foundKey) {
            imagePath = foundKey;
        } else {
            // Fallback image if not found
            imagePath = "../../assets/images/poland.jpg";
        }
    }
}

const imagePromise = images[imagePath]();
const requirements = [
    "Current Biopage Passport Picture",
    "Share code of Immigration Status and E-Visa expiry date",
    "Current UK Address",
    "Name of the company",
    "Your job title or designation",
    "Address of company",
    "Contact number of your company",
    "E-mail address of the company",
    "Your email and marital status",
];
---

<Layout pageName={`${displayName} Visa Detail`}>
    <!-- Hero Image -->
    <header class="w-[98%] mx-auto mt-2">
        <div class="w-full h-[400px] rounded-2xl overflow-hidden relative">
            <Image
                src={imagePromise}
                alt={`${displayName} Visa Header`}
                class="w-full h-full object-cover"
            />
            <div class="absolute inset-0 bg-black/20"></div>
            <h1
                class="absolute bottom-6 left-6 text-4xl font-bold text-white drop-shadow-md"
            >
                {displayName}
            </h1>
        </div>
    </header>

    <!-- Visa Details Section -->
    <section class="py-16 bg-white">
        <div class="container mx-auto px-6 max-w-4xl">
            <div class="text-center mb-12">
                <h2 class="text-3xl md:text-4xl font-bold text-brand-dark mb-4">
                    Visa Requirements
                </h2>
                <p class="text-gray-500 text-lg">
                    These are the things we require from your side to process
                    your application.
                </p>
            </div>

            <div
                class="bg-gray-50 rounded-2xl p-8 md:p-12 border border-gray-200 shadow-sm"
            >
                <ul class="space-y-4">
                    {
                        requirements.map((req, index) => (
                            <li class="flex items-start gap-4">
                                <div class="mt-1 min-w-[24px]">
                                    <div class="w-6 h-6 rounded-full bg-brand-blue text-white flex items-center justify-center text-xs font-bold">
                                        {index + 1}
                                    </div>
                                </div>
                                <span class="text-gray-700 font-medium">
                                    {req}
                                </span>
                            </li>
                        ))
                    }
                </ul>

                <div class="mt-12 text-center">
                    <a href="/contact.html">
                        <button
                            class="bg-brand-blue hover:bg-sky-600 text-white font-bold py-4 px-12 rounded-full transition-all shadow-lg hover:shadow-xl hover:scale-105 text-lg"
                        >
                            Apply Now
                        </button>
                    </a>
                </div>
            </div>
        </div>
    </section>
</Layout>
